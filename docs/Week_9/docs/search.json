[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Week 8: Generalised Linear Models part 2",
    "section": "",
    "text": "Last week we introduced Generalised Linear Models (GLMs). Particularly, we looked at logistic regression to model outcomes of interest that take one of two categorical values (e.g. yes/no, success/failure, alive/dead). This week we will continue reviewing logistic regression to model grouped binary outcomes (e.g. number of successes out of a fixed number of trials) and then we we will generalise this to situations where the response variable is categorical with more than two categories. First lets look at the framework for modelling categorical data with only two categories, i.e.\n\nbinary, taking the value 1 (say success, with probability \\(p\\)) or 0 (failure, with probability \\(1-p\\)) or\nbinomial, where \\(y_i\\) is the number of events (successes) in a given number of trials \\(n_i\\), with the probability of success being \\(p_i\\) and the probability of failure being \\(1-p_i\\).\n\nIn both cases the distribution of \\(y_i\\) is assumed to be binomial, but in the first case it is \\(\\mathrm{Bin}(1,p_i)\\) and in the second case it is \\(\\mathrm{Bin}(n_i,p_i)\\). The first case was covered last week, so now lets focus on the second case.\nBefore we proceed, we will load all the packages needed for this week:\n\nCodelibrary(tidyr)\nlibrary(ggplot2)\nlibrary(moderndive)\nlibrary(sjPlot)\nlibrary(tidymodels)\nlibrary(broom)\nlibrary(performance)\nlibrary(faraway)"
  },
  {
    "objectID": "index.html#modelling-grouped-binary-data-and-a-categorical-covariate",
    "href": "index.html#modelling-grouped-binary-data-and-a-categorical-covariate",
    "title": "Week 8: Generalised Linear Models part 2",
    "section": "\n2.1 Modelling grouped binary data and a categorical covariate",
    "text": "2.1 Modelling grouped binary data and a categorical covariate\nIn the last section we reviewed the case when the explanatory variable was continuous., lets look now at the case when the explanatory variable is categorical.\nTo illustrate how the previous model works with categorical predictors we can discretized the temperature values into arbitrary categories as follows:\n\\[\n\\mathrm{temperature~ category} =\\begin{cases} \\mathrm{temperature} &gt; 29^\\circ C  &  \\text{high} \\\\ \\mathrm{temperature} &gt; 28^\\circ C& \\text{medium} \\\\ \\text{else} & \\text{low}\\end{cases}\n\\]\nIn R we can use the case_when() function to accomplish this:\n\nCodeturtles = turtles  %&gt;% mutate(\n  temp_fct = case_when(\n    temp &gt; 29 ~ \"high\",\n    temp &gt; 28 ~ \"medium\",\n    .default = \"low\"\n  ) %&gt;% as.factor()\n) \n\n\nNow, recall that as usual, R will set the baseline category for our explanatory variable in alphabetical order, i.e. the high temperature level will be treated as reference for the dicretized variable. However, we already know that the chances of a male being hatched increases with higher incubation temperatures.\nThus, it makes sense to assess how the chances of a male being hatched are affected by comparing higher temperature categories against lower ones. This implies that we will set low to be our reference category. Luckily, we have seen in previous tasks how to do this using the relevel() function:\n\nturtles = turtles %&gt;%\n  mutate(temp_fct = relevel(temp_fct,ref = \"low\")) \n\nWe can now fit a logistic regression using the low temperature level as the reference category for our dicretized temperature covariate. The model is then given by:\n\\[\\begin{align}\ny_i &\\sim \\mathrm{Binomial}(n_ip_i)\\\\\n\\mathrm{logit}(p_i) &= \\alpha +  \\beta_{1}  \\times \\mathbb{I}_{\\mathrm{temperature}}(\\mathrm{high}) + \\beta_{2}  \\times \\mathbb{I}_{\\mathrm{temperature}}(\\mathrm{medium}).\n\\end{align}\\]\n\n\\(\\alpha\\) represent the log-odds of a male turtle being hatched in low incubation temperature.\n\\(\\beta_1\\) are the change int the log-odds of a male turtle being hatched given it was incubated in a high temperature condition compared to a low one.\n\\(\\mathbb{I}_{\\mathrm{temperature}}(\\mathrm{high})\\) is an indicator variable that takes the value of 1 if the \\(i\\)th experiment replicate was conducted on a high temperature.\n\\(\\beta_2\\) are the change int the log-odds of a male turtle being hatched given it was incubated in a medium condition compared to a low one.\n\\(\\mathbb{I}_{\\mathrm{temperature}}(\\mathrm{medium})\\) is an indicator variable that takes the value of 1 if the \\(i\\)th experiment replicate was conducted on a medium temperature.\n\nIn R, the model can be fitted as follows:\n\nmodel_turtles_2 &lt;- glm(cbind(male,female) ~ temp_fct,\n                     data = turtles,\n                     family = binomial)\n\nLets print the model estimates odds scale and 95% confidence intervals (remember we can achieve this by setting conf.int=TRUE and exponentiate=TRUE within the tidy function):\n\nmodel_turtles_2 %&gt;% broom::tidy(conf.int = T,exponentiate = T)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nterm\nestimate\nstd.error\nstatistic\np.value\nconf.low\nconf.high\n\n\n\n(Intercept)\n0.59\n0.29\n-1.80\n0.07\n0.33\n1.04\n\n\ntemp_fcthigh\n45.47\n1.06\n3.61\n0.00\n8.59\n843.97\n\n\ntemp_fctmedium\n6.32\n0.44\n4.23\n0.00\n2.76\n15.31\n\n\n\n\n\nWe can see that the odds of a male being hacthed if it was incubated on a low temperature condition are 0.59 the odds of a female being hatched if it was incubated on the same condition.\nAlternatively, we could interpret this as the odds of female being hatched in a low temperature incubation settings being \\(\\mathrm{exp}(\\alpha)^{-1} =\\) 1.68 higher than the odds of a male being hatched under the same setting. However, there is not enough evidence to support that the change in the odds is statistically significant since the confidence interval ( 0.33 , 1.04) contains 1 (remember we are in the odds scale).\nOn the other hand, the odds of a male being hatched are 45.47! significantly higher in a high temperature setting compared to a low temperature. Likewise, the odds of a male being hatched are 6.32 higher in a medium temperature contidion compared to a low one.\nWhat if we want to compare the odds of a male being hatched if the egg was incubate on a high temperture conditon against a medium one?\nIn that case, we we will be looking at the following odds ratio:\n\\[\\begin{align}\n\\dfrac{\\mathrm{Odds}(\\mathrm{male}=1|\\mathrm{temperature}=high)}{\\mathrm{Odds}(\\mathrm{male}=1|\\mathrm{temperature}=medium)} &= \\dfrac{\\frac{p_{\\mathrm{temperature}=high}}{1-p_{\\mathrm{temperature}=high}}}{\\frac{p_{\\mathrm{temperature}=medium}}{1-p_{\\mathrm{temperature}=medium}}}\\\\\n&= \\dfrac{\\mathrm{exp}(\\alpha+\\beta_1)}{\\mathrm{exp}(\\alpha+\\beta_2)} \\\\\n&= \\mathrm{exp}(\\alpha+\\beta_1 - \\alpha - \\beta_2) \\\\\n&= \\mathrm{exp}(\\beta_1 - \\beta_2) = \\frac{\\mathrm{exp}(\\beta_1)}{ \\mathrm{exp}(\\beta_2)}\n\\end{align}\\]\nWhere \\(\\beta_1\\) and \\(\\beta_2\\) are the coefficients in the log-odd scale. However since we already have \\(\\mathrm{exp}(\\beta_1)=\\) 45.47 and \\(\\mathrm{exp}(\\beta_2)=\\) 6.32, then the odds of male being hatched from an egg that was incubated on a high temperature condition are \\(\\frac{45.47}{6.32}=\\) 7.2 greater than the one that was incubate on a medium temperature condition.\nFinally, we can calculate the probabilities of a male being hatched in each temperature condition as follows:\n\n\n\\(P(\\mathrm{male}=1|\\mathrm{temperature}=low) = \\dfrac{\\mathrm{\\mathrm{exp}(\\alpha})}{1 + \\mathrm{exp}(\\alpha)}\\) In R this is:\n\nplogis(coef(model_turtles_2)[1])\n\n(Intercept) \n   0.372549 \n\n\n\n\n\\(P(\\mathrm{male}=1|\\mathrm{temperature}=medium) = \\dfrac{\\mathrm{\\mathrm{exp}(\\alpha + \\beta_1})}{1 + \\mathrm{exp}(\\alpha + \\beta_1)}\\) . In R this is equivalent to:\n\nplogis(coef(model_turtles_2)[1] + coef(model_turtles_2)[3])\n\n(Intercept) \n  0.7894737 \n\n\n\n\n\\(P(\\mathrm{male}=1|\\mathrm{temperature}=high) = \\dfrac{\\mathrm{\\mathrm{exp}(\\alpha + \\beta_2})}{1 + \\mathrm{exp}(\\alpha + \\beta_2)}\\). In R this is computed as:\n\nplogis(coef(model_turtles_2)[1] + coef(model_turtles_2)[2])\n\n(Intercept) \n  0.9642857 \n\n\n\n\nWe can visualize this probabilities using the plot_model() function as follows:\n\nCodeplot_model(type = \"pred\",\n           model_turtles_2,\n           terms = \"temp_fct\",\n           axis.title = c(\"Temperature Category\",\n                          \"Prob. of a hatchling being male\"),\n           title = \" \")"
  }
]